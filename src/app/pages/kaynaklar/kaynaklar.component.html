<section class="kaynaklar-page">
  <!-- Global Hero Section -->
  <app-hero-section
    title="RESOURCES.PAGE_TITLE"
    subtitle="RESOURCES.SUBTITLE"
    [breadcrumbs]="breadcrumbs"
    colorTheme="green">
  </app-hero-section>

  <div class="content-container" [@listAnimation]="sections.length">

  <!-- ARAMA BÖLÜMÜ (VURGU KARTI) -->
  <div class="info-card accent-card search-card" *ngIf="showSearch">
    <div class="md3-card__header">
      <span class="material-icons md3-card__avatar">search</span>
      <h3 class="section-headline">Hızlı Arama</h3>
    </div>
    <div class="md3-card__content">
      <div class="md3-text-field" appearance="outline" class="search-field">
        <label class="md3-text-field__label">Dokümanlarda ara...</label>
        <input class="md3-text-field__input" 
               [(ngModel)]="searchQuery"
               (input)="onSearchChange($event)"
               placeholder="Örn: aşı takvimi, uyku düzeni, emzirme">
        <span class="material-icons md3-text-field__icon md3-text-field__icon--trailing">search</span>
        <button class="md3-icon-button" matSuffix 
                *ngIf="searchQuery" 
                (click)="clearSearch()"
                aria-label="Temizle">
          <span class="material-icons">clear</span>
        </button>
      </div>

      <!-- Arama Sonuçları -->
      <div class="search-results" *ngIf="searchResults.length > 0">
        <hr class="md3-divider"></hr>
        <h3 class="results-title">
          <span class="material-icons">check_circle</span>
          {{ searchResults.length }} sonuç bulundu
        </h3>
        <div class="md3-list">
          <div class="md3-list-item" *ngFor="let doc of searchResults" 
                         (click)="viewDocument(doc)"
                         class="result-item">
            <span class="material-icons">description</span>
            <div matListItemTitle>{{ doc.title }}</div>
            <div matListItemLine>{{ getCategoryTitle(doc.categoryId) }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- İSTATİSTİKLER -->
  <section class="stats-section" [@fadeIn]>
    <div class="stat-card">
      <span class="material-icons">folder_open</span>
      <div class="stat-number">{{ categories.length }}</div>
      <div class="stat-label">Kategori</div>
    </div>
    <div class="stat-card">
      <span class="material-icons">description</span>
      <div class="stat-number">{{ getTotalDocumentCount() }}</div>
      <div class="stat-label">Doküman</div>
    </div>
    <div class="stat-card">
      <span class="material-icons">verified</span>
      <div class="stat-number">AAP</div>
      <div class="stat-label">Onaylı</div>
    </div>
  </section>

  <hr class="md3-divider" class="section-divider"></hr>

  <!-- KATEGORİLER -->
  <ng-container *ngFor="let section of sections; let i = index">
    <!-- VURGU KARTI (Önemli kategoriler) -->
    <div *ngIf="section.isAccent" 
              class="info-card accent-card category-card"
              [@cardAnimation]="i">
      <div class="md3-card__header">
        <span class="material-icons md3-card__avatar">{{ section.icon }}</span>
        <h3 class="section-headline">{{ section.title }}</h3>
        <p class="md3-card__subtitle">{{ section.subtitle }}</p>
      </div>
      <div-content class="body-text">
        <p [innerHTML]="section.description"></p>
        <div class="category-grid">
          <button class="md3-button md3-button-filled" 
                  *ngFor="let cat of section.categories"
                  (click)="navigateToCategory(cat.id)"
                  color="primary"
                  class="category-button">
            <span class="material-icons">{{ getQuickAccessIcon(cat.id) }}</span>
            <span>{{ cat.title }}</span>
            <span class="doc-count">({{ cat.documentCount }})</span>
          </button>
        </div>
      </div>
    </div>

    <!-- STANDART KATEGORİ KARTI -->
    <div *ngIf="!section.isAccent && !section.panels" 
              class="info-card category-card"
              [@cardAnimation]="i">
      <div class="md3-card__header">
        <span class="material-icons md3-card__avatar">{{ section.icon }}</span>
        <h3 class="section-headline">{{ section.title }}</h3>
        <p class="md3-card__subtitle">{{ section.subtitle }}</p>
      </div>
      <div-content class="body-text">
        <p [innerHTML]="section.description"></p>
        <div class="category-list">
          <div class="md3-list">
            <div class="md3-list-item" *ngFor="let cat of section.categories"
                           (click)="navigateToCategory(cat.id)"
                           class="category-item">
              <span class="material-icons">{{ getQuickAccessIcon(cat.id) }}</span>
              <div matListItemTitle>{{ cat.title }}</div>
              <div matListItemLine>{{ cat.documentCount }} doküman</div>
              <span class="material-icons">arrow_forward</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- AÇILIR PANEL KARTI (Detaylı bilgiler) -->
    <div *ngIf="section.panels" 
              class="info-card expansion-card"
              [@cardAnimation]="i">
      <div class="md3-card__header">
        <span class="material-icons md3-card__avatar">{{ section.icon }}</span>
        <h3 class="section-headline">{{ section.title }}</h3>
        <p class="md3-card__subtitle">{{ section.subtitle }}</p>
      </div>
      <div class="md3-card__content">
        <div class="md3-accordion">
          <details class="md3-expansion-panel" *ngFor="let panel of section.panels"
                                [expanded]="panel.expanded"
                                hideToggle>
            <summary class="md3-expansion-panel__header">
              <span class="md3-expansion-panel__title">
                <span class="material-icons">{{ panel.icon }}</span>
                {{ panel.title }}
              </span>
              <span class="md3-expansion-panel__description">
                {{ panel.description }}
              </span>
            </summary>
            <div class="panel-content" [innerHTML]="panel.content"></div>
            <div class="md3-expansion-panel__actions" *ngIf="panel.categoryId">
              <button class="md3-button" color="primary" 
                      (click)="navigateToCategory(panel.categoryId)">
                <span class="material-icons">folder_open</span>
                Kategoriye Git
              </button>
            </div>
          </details>
        </div>
      </div>
    </div>

    <hr class="md3-divider" class="section-divider" *ngIf="i < sections.length - 1"></hr>
  </ng-container>

  <!-- POPÜLER DOKÜMANLAR -->
  <section class="popular-section" *ngIf="popularDocuments.length > 0">
    <h2 class="section-title">
      <span class="material-icons">star</span>
      En Çok İndirilen Dokümanlar
    </h2>
    <div class="popular-grid">
      <div *ngFor="let doc of popularDocuments" 
                class="popular-card"
                (click)="viewDocument(doc)"
                [@fadeIn]>
        <div class="md3-card__header">
          <span class="material-icons md3-card__avatar">{{ getDocumentIcon(doc) }}</span>
          <h3>{{ doc.title }}</h3>
          <p class="md3-card__subtitle">{{ getCategoryTitle(doc.categoryId) }}</p>
        </div>
        <div class="md3-card__actions">
          <button class="md3-icon-button" (click)="downloadDocument(doc); $event.stopPropagation()">
            <span class="material-icons">download</span>
          </button>
          <button class="md3-icon-button">
            <span class="material-icons">visibility</span>
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- ALT BİLGİ -->
  <footer class="page-footer">
    <div class="footer-card">
      <span class="material-icons">info</span>
      <p>
        Tüm dokümanlar Amerikan Pediatri Akademisi (AAP) ve güvenilir sağlık kuruluşları tarafından hazırlanmıştır.
        Bilgiler güncel tutulmaya çalışılmaktadır ancak her zaman doktorunuza danışmanız önerilir.
      </p>
    </div>
  </footer>
  </div>
</section>