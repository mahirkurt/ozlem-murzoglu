// MD3 Motion Choreography System
// ===============================
// Implements Material Design 3's motion principles
// Based on emphasized easing and choreographed timing

// ============================
// Easing Functions (MD3 Standard)
// ============================

// Emphasized easing - The new default for MD3
$md3-easing-emphasized: cubic-bezier(0.2, 0, 0, 1);
$md3-easing-emphasized-decelerate: cubic-bezier(0.05, 0.7, 0.1, 1);
$md3-easing-emphasized-accelerate: cubic-bezier(0.3, 0, 0.8, 0.15);

// Standard easing - For micro interactions
$md3-easing-standard: cubic-bezier(0.2, 0, 0, 1);
$md3-easing-standard-decelerate: cubic-bezier(0, 0, 0, 1);
$md3-easing-standard-accelerate: cubic-bezier(0.3, 0, 1, 1);

// Linear - For continuous animations
$md3-easing-linear: linear;

// Legacy (MD2) - For backwards compatibility
$md3-easing-legacy: cubic-bezier(0.4, 0, 0.2, 1);

// ============================
// Duration Tokens
// ============================

// Short durations (50-200ms) - Micro interactions
$md3-duration-short1: 50ms;
$md3-duration-short2: 100ms;
$md3-duration-short3: 150ms;
$md3-duration-short4: 200ms;

// Medium durations (250-400ms) - Most transitions
$md3-duration-medium1: 250ms;
$md3-duration-medium2: 300ms;
$md3-duration-medium3: 350ms;
$md3-duration-medium4: 400ms;

// Long durations (450-600ms) - Complex animations
$md3-duration-long1: 450ms;
$md3-duration-long2: 500ms;
$md3-duration-long3: 550ms;
$md3-duration-long4: 600ms;

// Extra long (700-1000ms) - Page transitions
$md3-duration-extra-long1: 700ms;
$md3-duration-extra-long2: 800ms;
$md3-duration-extra-long3: 900ms;
$md3-duration-extra-long4: 1000ms;

// ============================
// Motion Mixins
// ============================

// Fade in animation
@mixin fade-in($duration: $md3-duration-medium2, $easing: $md3-easing-emphasized-decelerate) {
  animation: fadeIn $duration $easing both;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

// Fade out animation
@mixin fade-out($duration: $md3-duration-short4, $easing: $md3-easing-emphasized-accelerate) {
  animation: fadeOut $duration $easing both;
}

@keyframes fadeOut {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}

// Scale up animation (enter)
@mixin scale-up($duration: $md3-duration-medium2, $easing: $md3-easing-emphasized-decelerate) {
  animation: scaleUp $duration $easing both;
}

@keyframes scaleUp {
  from {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

// Scale down animation (exit)
@mixin scale-down($duration: $md3-duration-short4, $easing: $md3-easing-emphasized-accelerate) {
  animation: scaleDown $duration $easing both;
}

@keyframes scaleDown {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}

// Slide animations
@mixin slide-in-from-bottom($distance: 30px, $duration: $md3-duration-medium3) {
  animation: slideInFromBottom $duration $md3-easing-emphasized-decelerate both;
  
  @keyframes slideInFromBottom {
    from {
      opacity: 0;
      transform: translateY($distance);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
}

@mixin slide-in-from-top($distance: 30px, $duration: $md3-duration-medium3) {
  animation: slideInFromTop $duration $md3-easing-emphasized-decelerate both;
  
  @keyframes slideInFromTop {
    from {
      opacity: 0;
      transform: translateY(-$distance);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
}

@mixin slide-in-from-left($distance: 30px, $duration: $md3-duration-medium3) {
  animation: slideInFromLeft $duration $md3-easing-emphasized-decelerate both;
  
  @keyframes slideInFromLeft {
    from {
      opacity: 0;
      transform: translateX(-$distance);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
}

@mixin slide-in-from-right($distance: 30px, $duration: $md3-duration-medium3) {
  animation: slideInFromRight $duration $md3-easing-emphasized-decelerate both;
  
  @keyframes slideInFromRight {
    from {
      opacity: 0;
      transform: translateX($distance);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
}

// Expand animation (for containers)
@mixin expand($duration: $md3-duration-medium4) {
  animation: expand $duration $md3-easing-emphasized both;
  
  @keyframes expand {
    from {
      transform: scaleY(0);
      transform-origin: top;
    }
    to {
      transform: scaleY(1);
    }
  }
}

// Collapse animation
@mixin collapse($duration: $md3-duration-medium2) {
  animation: collapse $duration $md3-easing-emphasized-accelerate both;
  
  @keyframes collapse {
    from {
      transform: scaleY(1);
      transform-origin: top;
    }
    to {
      transform: scaleY(0);
    }
  }
}

// ============================
// Motion Choreography
// ============================

// Stagger animation for lists
@mixin stagger-animation($child-selector, $delay: 50ms, $base-duration: $md3-duration-medium2) {
  #{$child-selector} {
    opacity: 0;
    animation: staggerFadeIn $base-duration $md3-easing-emphasized-decelerate both;
    
    @for $i from 1 through 20 {
      &:nth-child(#{$i}) {
        animation-delay: #{$i * $delay};
      }
    }
  }
  
  @keyframes staggerFadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
}

// Container transform (shared element transition)
@mixin container-transform($duration: $md3-duration-long2) {
  transition: all $duration $md3-easing-emphasized;
  
  &.transforming {
    position: fixed;
    z-index: 9999;
  }
}

// Ripple effect
@mixin ripple-effect($color: currentColor) {
  position: relative;
  overflow: hidden;
  
  &::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: var(--md-sys-shape-corner-full);
    background: $color;
    opacity: 0.12;
    transform: translate(-50%, -50%);
    transition: width $md3-duration-long1 $md3-easing-emphasized,
                height $md3-duration-long1 $md3-easing-emphasized;
  }
  
  &:active::after {
    width: 300%;
    height: 300%;
  }
}

// ============================
// Page Transition Choreography
// ============================

@mixin page-enter-choreography {
  // Hero element enters first
  .hero-section {
    @include fade-in($md3-duration-medium4);
    @include slide-in-from-bottom(40px, $md3-duration-medium4);
  }
  
  // Primary content enters second
  .primary-content {
    @include fade-in($md3-duration-medium3);
    @include slide-in-from-bottom(30px, $md3-duration-medium3);
    animation-delay: $md3-duration-short2;
  }
  
  // Secondary elements enter last
  .secondary-content {
    @include fade-in($md3-duration-medium2);
    @include slide-in-from-bottom(20px, $md3-duration-medium2);
    animation-delay: $md3-duration-short3;
  }
  
  // Cards stagger in
  .card-grid {
    @include stagger-animation('.card', 75ms, $md3-duration-medium3);
  }
}

@mixin page-exit-choreography {
  // Secondary elements exit first
  .secondary-content {
    @include fade-out($md3-duration-short3);
    animation-delay: 0;
  }
  
  // Primary content exits second
  .primary-content {
    @include fade-out($md3-duration-short4);
    animation-delay: $md3-duration-short1;
  }
  
  // Hero element exits last
  .hero-section {
    @include fade-out($md3-duration-medium1);
    animation-delay: $md3-duration-short2;
  }
}

// ============================
// Component Motion Classes
// ============================

// Button interactions
.md3-button {
  transition: all $md3-duration-short4 $md3-easing-emphasized;
  @include ripple-effect();
  
  &:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(var(--md-sys-color-shadow), 0.15);
  }
  
  &:active {
    transform: translateY(0);
    transition-duration: $md3-duration-short2;
  }
}

// Card interactions
.md3-card {
  transition: all $md3-duration-medium2 $md3-easing-emphasized;
  
  &:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 16px rgba(var(--md-sys-color-shadow), 0.15);
  }
  
  &.expanding {
    @include container-transform();
  }
}

// FAB motion
.md3-fab {
  transition: all $md3-duration-medium2 $md3-easing-emphasized;
  
  &.extended {
    .fab-label {
      max-width: 200px;
      transition: max-width $md3-duration-medium3 $md3-easing-emphasized-decelerate;
    }
  }
  
  &.collapsed {
    .fab-label {
      max-width: 0;
      transition: max-width $md3-duration-medium1 $md3-easing-emphasized-accelerate;
    }
  }
}

// Dialog motion
.md3-dialog {
  &.entering {
    @include scale-up($md3-duration-medium3);
    @include fade-in($md3-duration-medium2);
  }
  
  &.exiting {
    @include scale-down($md3-duration-short4);
    @include fade-out($md3-duration-short3);
  }
}

// Navigation drawer motion
.md3-nav-drawer {
  transition: transform $md3-duration-medium3 $md3-easing-emphasized;
  
  &.closed {
    transform: translateX(-100%);
  }
  
  &.open {
    transform: translateX(0);
  }
}

// Bottom sheet motion
.md3-bottom-sheet {
  transition: transform $md3-duration-medium3 $md3-easing-emphasized-decelerate;
  
  &.closed {
    transform: translateY(100%);
  }
  
  &.open {
    transform: translateY(0);
  }
  
  &.expanded {
    transform: translateY(0);
    height: 90vh;
    transition: height $md3-duration-medium4 $md3-easing-emphasized;
  }
}

// Chip motion
.md3-chip {
  transition: all $md3-duration-short3 $md3-easing-standard;
  
  &:hover {
    background-color: rgba(var(--md-sys-color-primary-rgb), 0.08);
  }
  
  &.selected {
    background-color: rgba(var(--md-sys-color-primary-rgb), 0.12);
    transform: scale(1.02);
  }
  
  &.removing {
    @include scale-down($md3-duration-short3);
  }
}

// Tab transitions
.md3-tabs {
  .tab-indicator {
    transition: transform $md3-duration-medium1 $md3-easing-emphasized;
  }
  
  .tab-content {
    &.entering {
      @include slide-in-from-right(100%, $md3-duration-medium2);
    }
    
    &.exiting {
      opacity: 0;
      transition: opacity $md3-duration-short4 $md3-easing-emphasized-accelerate;
    }
  }
}

// Progress indicators
.md3-progress-linear {
  .progress-bar {
    transition: transform $md3-duration-medium4 $md3-easing-emphasized;
  }
  
  &.indeterminate {
    .progress-bar {
      animation: indeterminate 2s $md3-easing-linear infinite;
    }
  }
  
  @keyframes indeterminate {
    0% {
      transform: translateX(-100%);
    }
    100% {
      transform: translateX(200%);
    }
  }
}

// Snackbar motion
.md3-snackbar {
  &.entering {
    @include slide-in-from-bottom(100px, $md3-duration-medium2);
  }
  
  &.exiting {
    @include fade-out($md3-duration-short3);
    transform: translateY(20px);
  }
}

// ============================
// Scroll-triggered Animations
// ============================

.animate-on-scroll {
  opacity: 0;
  transform: translateY(30px);
  transition: all $md3-duration-medium3 $md3-easing-emphasized-decelerate;
  
  &.in-view {
    opacity: 1;
    transform: translateY(0);
  }
  
  &.scale {
    transform: scale(0.9);
    
    &.in-view {
      transform: scale(1);
    }
  }
  
  &.slide-left {
    transform: translateX(-50px);
    
    &.in-view {
      transform: translateX(0);
    }
  }
  
  &.slide-right {
    transform: translateX(50px);
    
    &.in-view {
      transform: translateX(0);
    }
  }
}

// ============================
// Utility Classes
// ============================

.no-motion {
  animation: none !important;
  transition: none !important;
}

.smooth-scroll {
  scroll-behavior: smooth;
}

.will-change-transform {
  will-change: transform;
}

.will-change-opacity {
  will-change: opacity;
}

.hardware-accelerated {
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
}