// MD3 Accessibility (A11y) System
// ================================
// Implements WCAG 2.1 AA/AAA standards with MD3 design principles
// Supports high contrast, reduced motion, and screen reader optimizations

// ============================
// High Contrast Mode Support
// ============================

@media (prefers-contrast: high) {
  :root {
    // Increase color contrast ratios
    --md-sys-color-primary: #005a4f;           // Darker teal
    --md-sys-color-on-primary: #ffffff;
    --md-sys-color-primary-container: #00897b;
    --md-sys-color-on-primary-container: #ffffff;
    
    --md-sys-color-secondary: #ff8f00;         // Darker amber
    --md-sys-color-on-secondary: #000000;
    --md-sys-color-secondary-container: #ffb300;
    --md-sys-color-on-secondary-container: #000000;
    
    // Stronger outlines
    --md-sys-color-outline: rgba(0, 0, 0, 0.87);
    --md-sys-color-outline-variant: rgba(0, 0, 0, 0.60);
    
    // Higher opacity for states
    --md-sys-state-hover-opacity: 0.12;
    --md-sys-state-focus-opacity: 0.16;
    --md-sys-state-pressed-opacity: 0.16;
    --md-sys-state-dragged-opacity: 0.20;
    
    // Stronger shadows
    --md-sys-elevation-level1: 0px 2px 4px rgba(0, 0, 0, 0.5);
    --md-sys-elevation-level2: 0px 4px 8px rgba(0, 0, 0, 0.5);
    --md-sys-elevation-level3: 0px 8px 16px rgba(0, 0, 0, 0.5);
  }
  
  // Stronger borders
  .md3-card,
  .md3-dialog,
  .md3-text-field {
    border: 2px solid var(--md-sys-color-outline);
  }
  
  // Enhanced button contrast
  .md3-button {
    border: 2px solid currentColor;
    font-weight: 600;
    
    &:hover {
      background-color: rgba(0, 0, 0, 0.12);
    }
    
    &:focus-visible {
      outline: 3px solid var(--md-sys-color-primary);
      outline-offset: 2px;
    }
  }
  
  // Enhanced link visibility
  a {
    text-decoration: underline;
    text-decoration-thickness: 2px;
    text-underline-offset: 2px;
    
    &:hover {
      text-decoration-thickness: 3px;
    }
  }
  
  // Stronger focus indicators
  *:focus-visible {
    outline: 3px solid var(--md-sys-color-primary);
    outline-offset: 2px;
  }
}

// ============================
// Reduced Motion Support
// ============================

@media (prefers-reduced-motion: reduce) {
  // Disable all animations
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  // Remove parallax effects
  .parallax {
    transform: none !important;
  }
  
  // Disable auto-play
  video[autoplay] {
    display: none;
  }
  
  // Simplify loading indicators
  .md3-progress-circular {
    animation: none !important;
    border: 4px solid var(--md-sys-color-primary);
  }
  
  // Static hover states
  .md3-button:hover,
  .md3-card:hover {
    transform: none !important;
  }
}

// ============================
// Color Blind Friendly Palettes
// ============================

// Protanopia/Deuteranopia (red-green color blindness)
.color-blind-friendly {
  // Use blue-orange palette instead of red-green
  --safe-success: #0066cc;  // Blue instead of green
  --safe-error: #ff6600;    // Orange instead of red
  --safe-warning: #ffcc00;  // Yellow
  --safe-info: #6600cc;     // Purple
  
  .success {
    color: var(--safe-success);
    background-color: rgba(0, 102, 204, 0.1);
  }
  
  .error {
    color: var(--safe-error);
    background-color: rgba(255, 102, 0, 0.1);
  }
  
  .warning {
    color: var(--safe-warning);
    background-color: rgba(255, 204, 0, 0.1);
  }
  
  .info {
    color: var(--safe-info);
    background-color: rgba(102, 0, 204, 0.1);
  }
}

// ============================
// Focus Management
// ============================

// Skip to content link
.skip-to-content {
  position: absolute;
  top: -40px;
  left: 0;
  background: var(--md-sys-color-primary);
  color: var(--md-sys-color-on-primary);
  padding: 8px 16px;
  border-radius: 0 0 8px 0;
  text-decoration: none;
  z-index: 10000;
  
  &:focus {
    top: 0;
  }
}

// Focus trap for modals
.focus-trap {
  &:focus {
    outline: none;
  }
}

// Visible focus for all interactive elements
button,
a,
input,
select,
textarea,
[role="button"],
[role="link"],
[tabindex]:not([tabindex="-1"]) {
  &:focus-visible {
    outline: 2px solid var(--md-sys-color-primary);
    outline-offset: 2px;
    border-radius: 4px;
  }
}

// ============================
// Screen Reader Support
// ============================

// Visually hidden but screen reader accessible
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

// Screen reader only focus visible
.sr-only-focusable:focus {
  position: static;
  width: auto;
  height: auto;
  padding: inherit;
  margin: inherit;
  overflow: visible;
  clip: auto;
  white-space: normal;
}

// Live regions for dynamic content
.aria-live-polite {
  position: absolute;
  left: -10000px;
  width: 1px;
  height: 1px;
  overflow: hidden;
}

// ============================
// Touch Target Sizing
// ============================

// Ensure minimum 44x44px touch targets (WCAG 2.1 AA)
button,
a,
input[type="checkbox"],
input[type="radio"],
.clickable {
  min-width: 44px;
  min-height: 44px;
  
  // Expand hit area for small elements
  &.small {
    position: relative;
    
    &::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      min-width: 44px;
      min-height: 44px;
    }
  }
}

// ============================
// Text Accessibility
// ============================

// Ensure readable line heights
body {
  line-height: 1.5;
}

p {
  line-height: 1.6;
  max-width: 70ch; // Optimal reading length
}

// Avoid text overlapping
* {
  word-break: break-word;
  overflow-wrap: break-word;
}

// ============================
// Form Accessibility
// ============================

// Required field indicators
.required::after {
  content: ' *';
  color: var(--md-sys-color-error);
  font-weight: bold;
  speak: literal-punctuation;
}

// Error messages
.error-message {
  color: var(--md-sys-color-error);
  font-size: 0.875rem;
  margin-top: 4px;
  
  &::before {
    content: 'âš  ';
    speak: literal-punctuation;
  }
}

// Form field labels
label {
  display: block;
  margin-bottom: 4px;
  font-weight: 500;
  cursor: pointer;
  
  &:hover {
    color: var(--md-sys-color-primary);
  }
}

// Fieldset and legend
fieldset {
  border: 2px solid var(--md-sys-color-outline-variant);
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 16px;
  
  legend {
    font-weight: 600;
    padding: 0 8px;
  }
}

// ============================
// Icon Accessibility
// ============================

// Decorative icons
.icon-decorative {
  aria-hidden: true;
}

// Informative icons need text
.icon-button {
  position: relative;
  
  .tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 200ms ease;
  }
  
  &:hover .tooltip,
  &:focus .tooltip {
    opacity: 1;
  }
}

// ============================
// Table Accessibility
// ============================

table {
  border-collapse: collapse;
  width: 100%;
  
  caption {
    font-weight: 600;
    margin-bottom: 8px;
    text-align: left;
  }
  
  th {
    background-color: var(--md-sys-color-surface-variant);
    font-weight: 600;
    text-align: left;
    padding: 12px;
  }
  
  td {
    padding: 12px;
    border-top: 1px solid var(--md-sys-color-outline-variant);
  }
  
  // Zebra striping for better readability
  tbody tr:nth-child(odd) {
    background-color: rgba(var(--md-sys-color-surface-variant-rgb), 0.05);
  }
  
  // Hover state
  tbody tr:hover {
    background-color: rgba(var(--md-sys-color-primary-rgb), 0.08);
  }
}

// ============================
// Loading States
// ============================

// Skeleton screens for loading
.skeleton {
  background: linear-gradient(
    90deg,
    var(--md-sys-color-surface-variant) 25%,
    var(--md-sys-color-surface-container) 50%,
    var(--md-sys-color-surface-variant) 75%
  );
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s ease-in-out infinite;
  
  @media (prefers-reduced-motion: reduce) {
    animation: none;
    background: var(--md-sys-color-surface-variant);
  }
}

@keyframes skeleton-loading {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}

// ============================
// Keyboard Navigation
// ============================

// Tab focus indicators
.keyboard-navigation {
  *:focus {
    outline: 2px dashed var(--md-sys-color-primary);
    outline-offset: 4px;
  }
}

// Keyboard shortcuts hint
.keyboard-hint {
  display: inline-block;
  background: var(--md-sys-color-surface-variant);
  padding: 2px 6px;
  border-radius: 4px;
  font-family: monospace;
  font-size: 0.875em;
  margin-left: 8px;
  
  kbd {
    background: var(--md-sys-color-surface);
    border: 1px solid var(--md-sys-color-outline-variant);
    border-radius: 2px;
    padding: 2px 4px;
    margin: 0 2px;
  }
}

// ============================
// Print Styles
// ============================

@media print {
  // Remove decorative elements
  .no-print,
  nav,
  .fab,
  .floating-actions,
  video,
  audio {
    display: none !important;
  }
  
  // Ensure text is black on white
  * {
    color: black !important;
    background: white !important;
  }
  
  // Show link URLs
  a[href]::after {
    content: " (" attr(href) ")";
  }
  
  // Avoid page breaks in important elements
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  
  p, li, blockquote {
    page-break-inside: avoid;
  }
}

// ============================
// Utility Classes
// ============================

// Text size controls
.text-size-controls {
  button {
    min-width: 44px;
    min-height: 44px;
    font-size: 1.2rem;
    font-weight: bold;
  }
}

// High contrast toggle
.contrast-toggle {
  min-width: 44px;
  min-height: 44px;
  
  &[aria-pressed="true"] {
    background-color: var(--md-sys-color-primary);
    color: var(--md-sys-color-on-primary);
  }
}

// Reduced motion toggle
.motion-toggle {
  min-width: 44px;
  min-height: 44px;
  
  &[aria-pressed="true"] {
    background-color: var(--md-sys-color-secondary);
    color: var(--md-sys-color-on-secondary);
  }
}