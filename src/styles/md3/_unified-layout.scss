// ============================================================================
// MD3 Unified Layout System
// Version: 5.0.0 (MD3 Expressive 2025)
//
// Comprehensive layout system with grid, containers, sections, and responsive
// layout patterns following Material Design 3 guidelines.
// ============================================================================

// ============================================================================
// TABLE OF CONTENTS
// ============================================================================
// 1. Layout CSS Variables
// 2. Breakpoint Variables
// 3. Container System
// 4. Grid System
// 5. Section System
// 6. Header Patterns
// 7. Aurora Backgrounds
// 8. Layout Patterns
// 9. Page Templates
// 10. Responsive Containers
// 11. Flex Layout Utilities
// 12. Grid Layout Utilities
// 13. Spacing System
// 14. Aspect Ratios
// 15. Stack & Cluster Patterns
// 16. Sidebar Layouts
// 17. Card Grid Layouts
// 18. Masonry Layouts
// 19. Full-Bleed Layouts
// 20. Responsive Media Queries
// 21. RTL Support
// 22. Accessibility
// 23. Layout Mixins
// ============================================================================

// ============================================================================
// 1. LAYOUT CSS VARIABLES
// ============================================================================

:root {
  // Container widths (MD3 breakpoints)
  --md-layout-container-compact: 100%;
  --md-layout-container-medium: 600px;
  --md-layout-container-expanded: 840px;
  --md-layout-container-large: 1200px;
  --md-layout-container-xlarge: 1400px;
  --md-layout-container-max: 1600px;

  // Container padding
  --md-layout-padding-compact: 16px;
  --md-layout-padding-medium: 24px;
  --md-layout-padding-expanded: 32px;
  --md-layout-padding-large: 48px;
  --md-layout-padding-xlarge: 64px;

  // Section spacing
  --md-layout-section-spacing-compact: 48px;
  --md-layout-section-spacing-medium: 64px;
  --md-layout-section-spacing-expanded: 80px;
  --md-layout-section-spacing-large: 100px;
  --md-layout-section-spacing-xlarge: 120px;

  // Grid configuration
  --md-layout-grid-columns: 12;
  --md-layout-grid-gap: 24px;
  --md-layout-grid-gap-compact: 16px;
  --md-layout-grid-gap-large: 32px;

  // Content widths
  --md-layout-content-narrow: 680px;
  --md-layout-content-medium: 800px;
  --md-layout-content-wide: 1000px;
  --md-layout-content-full: 100%;

  // Sidebar widths
  --md-layout-sidebar-narrow: 240px;
  --md-layout-sidebar-medium: 280px;
  --md-layout-sidebar-wide: 320px;
  --md-layout-sidebar-navigation: 72px;
  --md-layout-sidebar-navigation-expanded: 256px;

  // Header heights
  --md-layout-header-height: 64px;
  --md-layout-header-height-compact: 56px;
  --md-layout-header-height-expanded: 80px;

  // Footer heights
  --md-layout-footer-height: auto;
  --md-layout-footer-min-height: 200px;

  // Z-index layers
  --md-layout-z-base: 0;
  --md-layout-z-dropdown: 100;
  --md-layout-z-sticky: 200;
  --md-layout-z-fixed: 300;
  --md-layout-z-drawer: 400;
  --md-layout-z-modal-backdrop: 500;
  --md-layout-z-modal: 600;
  --md-layout-z-popover: 700;
  --md-layout-z-tooltip: 800;
  --md-layout-z-toast: 900;
  --md-layout-z-max: 9999;
}

// ============================================================================
// 2. BREAKPOINT VARIABLES
// ============================================================================

$breakpoint-compact: 0;
$breakpoint-medium: 600px;
$breakpoint-expanded: 840px;
$breakpoint-large: 1200px;
$breakpoint-xlarge: 1600px;

$breakpoints: (
  'compact': $breakpoint-compact,
  'medium': $breakpoint-medium,
  'expanded': $breakpoint-expanded,
  'large': $breakpoint-large,
  'xlarge': $breakpoint-xlarge
);

// Legacy section padding (for backward compatibility)
$section-padding-desktop: 100px 0;
$section-padding-mobile: 64px 0;

// ============================================================================
// 3. CONTAINER SYSTEM
// ============================================================================

// Base container
.container {
  width: 100%;
  max-width: var(--md-layout-container-max);
  margin-inline: auto;
  padding-inline: var(--md-layout-padding-compact);

  @media (min-width: $breakpoint-medium) {
    padding-inline: var(--md-layout-padding-medium);
  }

  @media (min-width: $breakpoint-expanded) {
    padding-inline: var(--md-layout-padding-expanded);
  }

  @media (min-width: $breakpoint-large) {
    padding-inline: var(--md-layout-padding-large);
  }

  @media (min-width: $breakpoint-xlarge) {
    padding-inline: var(--md-layout-padding-xlarge);
  }
}

// Container size variants
.container-fluid {
  width: 100%;
  padding-inline: var(--md-layout-padding-compact);

  @media (min-width: $breakpoint-medium) {
    padding-inline: var(--md-layout-padding-medium);
  }

  @media (min-width: $breakpoint-expanded) {
    padding-inline: var(--md-layout-padding-expanded);
  }
}

.container-narrow {
  @extend .container;
  max-width: var(--md-layout-content-narrow);
}

.container-medium {
  @extend .container;
  max-width: var(--md-layout-content-medium);
}

.container-wide {
  @extend .container;
  max-width: var(--md-layout-content-wide);
}

.container-large {
  @extend .container;
  max-width: var(--md-layout-container-large);
}

.container-xlarge {
  @extend .container;
  max-width: var(--md-layout-container-xlarge);
}

// ============================================================================
// 4. GRID SYSTEM
// ============================================================================

// CSS Grid based 12-column system
.grid {
  display: grid;
  grid-template-columns: repeat(var(--md-layout-grid-columns), 1fr);
  gap: var(--md-layout-grid-gap-compact);

  @media (min-width: $breakpoint-medium) {
    gap: var(--md-layout-grid-gap);
  }

  @media (min-width: $breakpoint-large) {
    gap: var(--md-layout-grid-gap-large);
  }
}

// Grid column spans
@for $i from 1 through 12 {
  .col-#{$i} {
    grid-column: span #{$i};
  }
}

// Responsive grid columns
@media (min-width: $breakpoint-compact) {
  @for $i from 1 through 12 {
    .col-compact-#{$i} {
      grid-column: span #{$i};
    }
  }
}

@media (min-width: $breakpoint-medium) {
  @for $i from 1 through 12 {
    .col-medium-#{$i} {
      grid-column: span #{$i};
    }
  }
}

@media (min-width: $breakpoint-expanded) {
  @for $i from 1 through 12 {
    .col-expanded-#{$i} {
      grid-column: span #{$i};
    }
  }
}

@media (min-width: $breakpoint-large) {
  @for $i from 1 through 12 {
    .col-large-#{$i} {
      grid-column: span #{$i};
    }
  }
}

@media (min-width: $breakpoint-xlarge) {
  @for $i from 1 through 12 {
    .col-xlarge-#{$i} {
      grid-column: span #{$i};
    }
  }
}

// Auto-fit grids
.grid-auto {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
}

.grid-auto-sm {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
}

.grid-auto-lg {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
}

// Fixed column grids
.grid-2 {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: repeat(1, 1fr);

  @media (min-width: $breakpoint-medium) {
    grid-template-columns: repeat(2, 1fr);
  }
}

.grid-3 {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: repeat(1, 1fr);

  @media (min-width: $breakpoint-medium) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: $breakpoint-expanded) {
    grid-template-columns: repeat(3, 1fr);
  }
}

.grid-4 {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: repeat(1, 1fr);

  @media (min-width: $breakpoint-medium) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: $breakpoint-large) {
    grid-template-columns: repeat(4, 1fr);
  }
}

.grid-6 {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: repeat(2, 1fr);

  @media (min-width: $breakpoint-medium) {
    grid-template-columns: repeat(3, 1fr);
  }

  @media (min-width: $breakpoint-large) {
    grid-template-columns: repeat(6, 1fr);
  }
}

// ============================================================================
// 5. SECTION SYSTEM
// ============================================================================

// Base section
.section {
  padding-block: var(--md-layout-section-spacing-compact);

  @media (min-width: $breakpoint-medium) {
    padding-block: var(--md-layout-section-spacing-medium);
  }

  @media (min-width: $breakpoint-expanded) {
    padding-block: var(--md-layout-section-spacing-expanded);
  }

  @media (min-width: $breakpoint-large) {
    padding-block: var(--md-layout-section-spacing-large);
  }

  @media (min-width: $breakpoint-xlarge) {
    padding-block: var(--md-layout-section-spacing-xlarge);
  }
}

// Section variants
.section-compact {
  padding-block: var(--md-layout-section-spacing-compact);
}

.section-medium {
  padding-block: var(--md-layout-section-spacing-medium);

  @media (min-width: $breakpoint-expanded) {
    padding-block: var(--md-layout-section-spacing-expanded);
  }
}

.section-large {
  padding-block: var(--md-layout-section-spacing-large);

  @media (min-width: $breakpoint-large) {
    padding-block: var(--md-layout-section-spacing-xlarge);
  }
}

// Section backgrounds
.section-surface {
  background: var(--md-sys-color-surface);
}

.section-surface-variant {
  background: var(--md-sys-color-surface-variant);
}

.section-surface-container {
  background: var(--md-sys-color-surface-container);
}

.section-surface-container-low {
  background: var(--md-sys-color-surface-container-low);
}

.section-surface-container-high {
  background: var(--md-sys-color-surface-container-high);
}

.section-primary {
  background: var(--md-sys-color-primary-container);
  color: var(--md-sys-color-on-primary-container);
}

.section-secondary {
  background: var(--md-sys-color-secondary-container);
  color: var(--md-sys-color-on-secondary-container);
}

.section-tertiary {
  background: var(--md-sys-color-tertiary-container);
  color: var(--md-sys-color-on-tertiary-container);
}

// ============================================================================
// 6. HEADER PATTERNS
// ============================================================================

// Unified section header mixin
@mixin section-header-unified {
  text-align: center;
  margin-block-end: 48px;

  .section-label {
    display: inline-block;
    padding: 8px 16px;
    background: rgba(var(--md-sys-color-primary-rgb), 0.1);
    color: var(--md-sys-color-primary);
    border-radius: var(--md-sys-shape-corner-full, 100px);
    font-family: var(--md-sys-typescale-label-large-font);
    font-size: var(--md-sys-typescale-label-large-size, 14px);
    font-weight: var(--md-sys-typescale-label-large-weight, 500);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-block-end: 16px;
    backdrop-filter: blur(4px);
    border: 1px solid rgba(var(--md-sys-color-primary-rgb), 0.2);
  }

  h2, .section-title {
    font-family: var(--md-sys-typescale-display-small-font);
    font-size: var(--md-sys-typescale-display-small-size, 36px);
    font-weight: var(--md-sys-typescale-display-small-weight, 400);
    letter-spacing: var(--md-sys-typescale-display-small-tracking, 0);
    line-height: var(--md-sys-typescale-display-small-line-height, 44px);
    margin: 0 0 24px 0;

    // Gradient Text Style (Teal Tones - Primary to Inverse Primary)
    background: linear-gradient(135deg,
      var(--md-sys-color-primary) 0%,
      var(--md-sys-color-inverse-primary) 100%
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;

    // Fallback for old browsers
    color: var(--md-sys-color-primary);

    @media (min-width: $breakpoint-medium) {
      font-size: var(--md-sys-typescale-display-medium-size, 45px);
      line-height: var(--md-sys-typescale-display-medium-line-height, 52px);
    }

    @media (min-width: $breakpoint-large) {
      // Standardized to Medium for consistency, avoiding excessive Large size
      font-size: var(--md-sys-typescale-display-medium-size, 45px);
      line-height: var(--md-sys-typescale-display-medium-line-height, 52px);
    }
  }

  p, .section-subtitle {
    font-family: var(--md-sys-typescale-body-large-font);
    font-size: var(--md-sys-typescale-body-large-size, 16px);
    line-height: var(--md-sys-typescale-body-large-line-height, 24px);
    color: var(--md-sys-color-on-surface-variant);
    max-width: 700px;
    margin-inline: auto;

    @media (min-width: $breakpoint-medium) {
      font-size: 18px;
      line-height: 1.6;
    }
  }
}

// Section header class
.section-header {
  @include section-header-unified;
}

// Left-aligned section header
.section-header-left {
  @include section-header-unified;
  text-align: start;

  p, .section-subtitle {
    margin-inline-start: 0;
    margin-inline-end: auto;
  }
}

// ========================================================================
// 6.1 PAGE HEADER STYLES
// ========================================================================

.md3-page-header {
  --md3-page-header-text: color-mix(
    in oklch,
    var(--md-sys-color-on-primary-container) 88%,
    var(--md-sys-color-on-surface) 12%
  );
  --md3-page-header-subtitle: color-mix(
    in oklch,
    var(--md-sys-color-on-primary-container) 72%,
    var(--md-sys-color-on-surface-variant) 28%
  );
  --md3-page-header-chip-bg: color-mix(in oklch, var(--md-sys-color-surface) 92%, transparent);
  --md3-page-header-chip-bg-strong: color-mix(in oklch, var(--md-sys-color-surface) 96%, transparent);
  --md3-page-header-chip-border: color-mix(in oklch, var(--md-sys-color-outline) 28%, transparent);
  --md3-page-header-chip-text: color-mix(in oklch, var(--md-sys-color-on-surface) 92%, transparent);
  --md3-page-header-chip-shadow: 0 12px 28px oklch(from var(--md-sys-color-shadow) l c h / 0.16);
  --md3-page-header-title-shadow: 0 18px 48px oklch(from var(--md-sys-color-shadow) l c h / 0.2);
  color: var(--md3-page-header-text);
}

:root[data-theme='dark'] .md3-page-header,
:root.dark-theme .md3-page-header {
  --md3-page-header-text: var(--md-sys-color-on-surface);
  --md3-page-header-subtitle: var(--md-sys-color-on-surface-variant);
  --md3-page-header-chip-bg: color-mix(
    in oklch,
    var(--md-sys-color-surface-container-high) 92%,
    transparent
  );
  --md3-page-header-chip-bg-strong: color-mix(
    in oklch,
    var(--md-sys-color-surface-container-highest) 94%,
    transparent
  );
  --md3-page-header-chip-border: color-mix(in oklch, var(--md-sys-color-outline) 40%, transparent);
  --md3-page-header-chip-text: var(--md-sys-color-on-surface);
  --md3-page-header-title-shadow: 0 18px 48px oklch(from var(--md-sys-color-shadow) l c h / 0.45);
}

.md3-page-breadcrumbs ol {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: var(--md-sys-spacing-breadcrumb-gap);
  justify-content: center;
}

.md3-page-breadcrumbs li {
  display: inline-flex;
  align-items: center;
  gap: var(--md-sys-spacing-1);
}

.md3-breadcrumb-link,
.md3-breadcrumb-current {
  display: inline-flex;
  align-items: center;
  gap: var(--md-sys-spacing-1);
  padding: var(--md-sys-spacing-1) var(--md-sys-spacing-4);
  border-radius: var(--md-sys-shape-corner-full);
  font-family: var(--md-sys-typescale-label-medium-font);
  font-size: var(--md-sys-typescale-label-medium-size);
  font-weight: var(--md-sys-typescale-label-medium-weight);
  line-height: var(--md-sys-typescale-label-medium-line-height);
  letter-spacing: var(--md-sys-typescale-label-medium-tracking);
  text-decoration: none;
  backdrop-filter: blur(var(--md-sys-glass-blur-md)) saturate(1.25);
  -webkit-backdrop-filter: blur(var(--md-sys-glass-blur-md)) saturate(1.25);
  transition: var(--md-sys-transition-standard);
}

.md3-breadcrumb-link {
  @extend .md3-state-layer;
  background: var(--md3-page-header-chip-bg);
  background-image: linear-gradient(
    135deg,
    color-mix(in oklch, var(--md-sys-color-surface) 90%, transparent) 0%,
    color-mix(in oklch, var(--md-sys-color-primary-container) 22%, transparent) 100%
  );
  border: 1px solid var(--md3-page-header-chip-border);
  color: var(--md3-page-header-chip-text);
  box-shadow: var(--md3-page-header-chip-shadow);

  &:hover {
    transform: translateY(calc(-1 * var(--md-sys-spacing-1)));
    box-shadow: var(--md-sys-elevation-level2);
    border-color: color-mix(in oklch, var(--md-sys-color-primary) 40%, transparent);
  }

  &:active {
    transform: translateY(0);
  }
}

.md3-breadcrumb-current {
  background: var(--md3-page-header-chip-bg-strong);
  background-image: linear-gradient(
    135deg,
    color-mix(in oklch, var(--md-sys-color-surface) 94%, transparent) 0%,
    color-mix(in oklch, var(--md-sys-color-primary-container) 28%, transparent) 100%
  );
  border: 1px solid color-mix(in oklch, var(--md-sys-color-outline) 34%, transparent);
  color: var(--md3-page-header-chip-text);
  box-shadow: var(--md-sys-elevation-level1);
  font-weight: calc(var(--md-sys-typescale-label-medium-weight) + 100);
}

.md3-breadcrumb-separator {
  color: color-mix(in oklch, var(--md3-page-header-chip-text) 65%, transparent);
  font-size: var(--md-icon-size-sm);
  display: inline-flex;
  align-items: center;
}

.md3-page-header-title {
  font-family: var(--md-sys-typescale-display-medium-font);
  font-size: clamp(2.2rem, 2vw + 1.4rem, 3.2rem);
  font-weight: var(--md-sys-typescale-display-medium-weight);
  line-height: 1.1;
  letter-spacing: -0.01em;
  color: var(--md3-page-header-text);
  text-shadow: var(--md3-page-header-title-shadow);
  margin: 0;
}

.md3-page-header-subtitle {
  font-family: var(--md-sys-typescale-headline-small-font);
  font-size: clamp(1.05rem, 0.7vw + 0.9rem, 1.4rem);
  font-weight: var(--md-sys-typescale-headline-small-weight);
  line-height: 1.55;
  letter-spacing: 0.1px;
  color: var(--md3-page-header-subtitle);
  max-width: var(--md-sys-spacing-text-max-width);
  margin: 0;
}

// ============================================================================
// 7. AURORA BACKGROUNDS
// ============================================================================

// Aurora full-width background pattern mixin
@mixin aurora-section-bg {
  position: relative;
  background: var(--md-sys-color-surface);
  overflow: hidden;

  // Primary ambient gradient
  &::before {
    content: '';
    position: absolute;
    top: -20%;
    left: 20%;
    width: 60%;
    height: 80%;
    background: radial-gradient(circle at center,
      rgba(var(--md-sys-color-primary-rgb), 0.08) 0%,
      transparent 70%);
    filter: blur(80px);
    z-index: 0;
    pointer-events: none;
  }

  // Tertiary ambient gradient
  &::after {
    content: '';
    position: absolute;
    bottom: -10%;
    right: -10%;
    width: 50%;
    height: 60%;
    background: radial-gradient(circle at center,
      rgba(var(--md-sys-color-tertiary-rgb), 0.06) 0%,
      transparent 70%);
    filter: blur(60px);
    z-index: 0;
    pointer-events: none;
  }

  // Ensure content is above background effects
  > * {
    position: relative;
    z-index: 1;
  }
}

// Aurora background class
.aurora-bg {
  @include aurora-section-bg;
}

// Aurora variants
@mixin aurora-primary-bg {
  position: relative;
  overflow: hidden;

  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background:
      radial-gradient(ellipse at 20% 0%,
        rgba(var(--md-sys-color-primary-rgb), 0.12) 0%,
        transparent 50%),
      radial-gradient(ellipse at 80% 100%,
        rgba(var(--md-sys-color-primary-rgb), 0.08) 0%,
        transparent 50%);
    filter: blur(60px);
    z-index: 0;
    pointer-events: none;
  }

  > * {
    position: relative;
    z-index: 1;
  }
}

@mixin aurora-secondary-bg {
  position: relative;
  overflow: hidden;

  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background:
      radial-gradient(ellipse at 30% 20%,
        rgba(var(--md-sys-color-secondary-rgb), 0.10) 0%,
        transparent 50%),
      radial-gradient(ellipse at 70% 80%,
        rgba(var(--md-sys-color-secondary-rgb), 0.06) 0%,
        transparent 50%);
    filter: blur(60px);
    z-index: 0;
    pointer-events: none;
  }

  > * {
    position: relative;
    z-index: 1;
  }
}

@mixin aurora-gradient-bg {
  position: relative;
  overflow: hidden;

  &::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background:
      radial-gradient(ellipse at 20% 30%,
        rgba(var(--md-sys-color-primary-rgb), 0.10) 0%,
        transparent 40%),
      radial-gradient(ellipse at 80% 20%,
        rgba(var(--md-sys-color-secondary-rgb), 0.08) 0%,
        transparent 40%),
      radial-gradient(ellipse at 50% 80%,
        rgba(var(--md-sys-color-tertiary-rgb), 0.06) 0%,
        transparent 40%);
    filter: blur(80px);
    z-index: 0;
    pointer-events: none;
    animation: aurora-float 20s ease-in-out infinite;
  }

  > * {
    position: relative;
    z-index: 1;
  }
}

@keyframes aurora-float {
  0%, 100% {
    transform: translate(0, 0) rotate(0deg);
  }
  33% {
    transform: translate(2%, 1%) rotate(1deg);
  }
  66% {
    transform: translate(-1%, -2%) rotate(-1deg);
  }
}

// Aurora background classes
.aurora-primary-bg {
  @include aurora-primary-bg;
}

.aurora-secondary-bg {
  @include aurora-secondary-bg;
}

.aurora-gradient-bg {
  @include aurora-gradient-bg;
}

// ============================================================================
// 8. LAYOUT PATTERNS
// ============================================================================

// Holy grail layout
.layout-holy-grail {
  display: grid;
  min-height: 100vh;
  grid-template-rows: auto 1fr auto;
  grid-template-columns: 1fr;

  > header {
    grid-row: 1;
  }

  > main {
    grid-row: 2;
  }

  > footer {
    grid-row: 3;
  }
}

// Sticky header layout
.layout-sticky-header {
  display: flex;
  flex-direction: column;
  min-height: 100vh;

  > header {
    position: sticky;
    top: 0;
    z-index: var(--md-layout-z-sticky);
  }

  > main {
    flex: 1;
  }
}

// Fixed sidebar layout
.layout-sidebar {
  display: grid;
  min-height: 100vh;
  grid-template-columns: 1fr;

  @media (min-width: $breakpoint-expanded) {
    grid-template-columns: var(--md-layout-sidebar-medium) 1fr;
  }

  @media (min-width: $breakpoint-large) {
    grid-template-columns: var(--md-layout-sidebar-wide) 1fr;
  }
}

.layout-sidebar-right {
  display: grid;
  min-height: 100vh;
  grid-template-columns: 1fr;

  @media (min-width: $breakpoint-expanded) {
    grid-template-columns: 1fr var(--md-layout-sidebar-medium);
  }

  @media (min-width: $breakpoint-large) {
    grid-template-columns: 1fr var(--md-layout-sidebar-wide);
  }
}

// Two column layout
.layout-two-column {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: 1fr;

  @media (min-width: $breakpoint-medium) {
    grid-template-columns: repeat(2, 1fr);
  }
}

// Three column layout
.layout-three-column {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: 1fr;

  @media (min-width: $breakpoint-medium) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: $breakpoint-large) {
    grid-template-columns: repeat(3, 1fr);
  }
}

// ============================================================================
// 9. PAGE TEMPLATES
// ============================================================================

// Base page layout
.page {
  min-height: 100vh;
  display: flex;
  flex-direction: column;

  > main {
    flex: 1;
  }
}

// Landing page layout
.page-landing {
  @extend .page;

  > main {
    > section:first-child {
      padding-top: 0;
    }
  }
}

// Article page layout
.page-article {
  @extend .page;

  .article-content {
    max-width: var(--md-layout-content-narrow);
    margin-inline: auto;
    padding-inline: var(--md-layout-padding-compact);

    @media (min-width: $breakpoint-medium) {
      padding-inline: var(--md-layout-padding-medium);
    }
  }
}

// Dashboard layout
.page-dashboard {
  display: grid;
  min-height: 100vh;
  grid-template-rows: var(--md-layout-header-height) 1fr;
  grid-template-columns: var(--md-layout-sidebar-navigation) 1fr;

  @media (min-width: $breakpoint-large) {
    grid-template-columns: var(--md-layout-sidebar-navigation-expanded) 1fr;
  }

  > header {
    grid-column: 1 / -1;
  }

  > aside {
    grid-row: 2;
    grid-column: 1;
  }

  > main {
    grid-row: 2;
    grid-column: 2;
    overflow-y: auto;
  }
}

// ============================================================================
// 10. RESPONSIVE CONTAINERS
// ============================================================================

// Content width containers
.content-narrow {
  max-width: var(--md-layout-content-narrow);
  margin-inline: auto;
}

.content-medium {
  max-width: var(--md-layout-content-medium);
  margin-inline: auto;
}

.content-wide {
  max-width: var(--md-layout-content-wide);
  margin-inline: auto;
}

.content-full {
  width: 100%;
}

// Responsive centering
.center-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
}

.center-horizontal {
  margin-inline: auto;
}

.center-vertical {
  display: flex;
  align-items: center;
  min-height: 100%;
}

.center-both {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100%;
}

// ============================================================================
// 11. FLEX LAYOUT UTILITIES
// ============================================================================

.flex-row {
  display: flex;
  flex-direction: row;
  gap: var(--md-layout-grid-gap);
}

.flex-column {
  display: flex;
  flex-direction: column;
  gap: var(--md-layout-grid-gap);
}

.flex-wrap {
  flex-wrap: wrap;
}

.flex-nowrap {
  flex-wrap: nowrap;
}

.flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

.flex-between {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.flex-around {
  display: flex;
  align-items: center;
  justify-content: space-around;
}

.flex-evenly {
  display: flex;
  align-items: center;
  justify-content: space-evenly;
}

.flex-start {
  display: flex;
  align-items: flex-start;
  justify-content: flex-start;
}

.flex-end {
  display: flex;
  align-items: flex-end;
  justify-content: flex-end;
}

.flex-grow {
  flex-grow: 1;
}

.flex-shrink-0 {
  flex-shrink: 0;
}

// ============================================================================
// 12. GRID LAYOUT UTILITIES
// ============================================================================

.grid-center {
  display: grid;
  place-items: center;
}

.grid-start {
  display: grid;
  place-items: start;
}

.grid-end {
  display: grid;
  place-items: end;
}

.grid-stretch {
  display: grid;
  place-items: stretch;
}

// Grid alignment
.grid-align-start {
  align-items: start;
}

.grid-align-center {
  align-items: center;
}

.grid-align-end {
  align-items: end;
}

.grid-justify-start {
  justify-items: start;
}

.grid-justify-center {
  justify-items: center;
}

.grid-justify-end {
  justify-items: end;
}

// ============================================================================
// 13. SPACING SYSTEM
// ============================================================================

// Vertical spacing between elements
.space-y-xs > * + * {
  margin-block-start: 4px;
}

.space-y-sm > * + * {
  margin-block-start: 8px;
}

.space-y-md > * + * {
  margin-block-start: 16px;
}

.space-y-lg > * + * {
  margin-block-start: 24px;
}

.space-y-xl > * + * {
  margin-block-start: 32px;
}

.space-y-2xl > * + * {
  margin-block-start: 48px;
}

.space-y-3xl > * + * {
  margin-block-start: 64px;
}

// Horizontal spacing between elements
.space-x-xs > * + * {
  margin-inline-start: 4px;
}

.space-x-sm > * + * {
  margin-inline-start: 8px;
}

.space-x-md > * + * {
  margin-inline-start: 16px;
}

.space-x-lg > * + * {
  margin-inline-start: 24px;
}

.space-x-xl > * + * {
  margin-inline-start: 32px;
}

// Gap utilities
.gap-xs { gap: 4px; }
.gap-sm { gap: 8px; }
.gap-md { gap: 16px; }
.gap-lg { gap: 24px; }
.gap-xl { gap: 32px; }
.gap-2xl { gap: 48px; }
.gap-3xl { gap: 64px; }

// ============================================================================
// 14. ASPECT RATIOS
// ============================================================================

.aspect-square {
  aspect-ratio: 1 / 1;
}

.aspect-video {
  aspect-ratio: 16 / 9;
}

.aspect-photo {
  aspect-ratio: 4 / 3;
}

.aspect-portrait {
  aspect-ratio: 3 / 4;
}

.aspect-wide {
  aspect-ratio: 21 / 9;
}

.aspect-golden {
  aspect-ratio: 1.618 / 1;
}

// ============================================================================
// 15. STACK & CLUSTER PATTERNS
// ============================================================================

// Stack pattern (vertical)
.stack {
  display: flex;
  flex-direction: column;
  gap: var(--stack-gap, 16px);

  &--xs { --stack-gap: 4px; }
  &--sm { --stack-gap: 8px; }
  &--md { --stack-gap: 16px; }
  &--lg { --stack-gap: 24px; }
  &--xl { --stack-gap: 32px; }
}

// Cluster pattern (horizontal with wrap)
.cluster {
  display: flex;
  flex-wrap: wrap;
  gap: var(--cluster-gap, 16px);
  align-items: center;

  &--xs { --cluster-gap: 4px; }
  &--sm { --cluster-gap: 8px; }
  &--md { --cluster-gap: 16px; }
  &--lg { --cluster-gap: 24px; }
  &--xl { --cluster-gap: 32px; }
}

// ============================================================================
// 16. SIDEBAR LAYOUTS
// ============================================================================

// Sidebar (not) pattern
.with-sidebar {
  display: flex;
  flex-wrap: wrap;
  gap: var(--md-layout-grid-gap);

  > :first-child {
    flex-basis: var(--md-layout-sidebar-medium);
    flex-grow: 1;
  }

  > :last-child {
    flex-basis: 0;
    flex-grow: 999;
    min-width: 50%;
  }
}

.with-sidebar-right {
  display: flex;
  flex-wrap: wrap;
  gap: var(--md-layout-grid-gap);

  > :first-child {
    flex-basis: 0;
    flex-grow: 999;
    min-width: 50%;
  }

  > :last-child {
    flex-basis: var(--md-layout-sidebar-medium);
    flex-grow: 1;
  }
}

// ============================================================================
// 17. CARD GRID LAYOUTS
// ============================================================================

.card-grid {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
}

.card-grid-sm {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
}

.card-grid-lg {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
}

// Fixed card grids
.card-grid-2 {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: 1fr;

  @media (min-width: $breakpoint-medium) {
    grid-template-columns: repeat(2, 1fr);
  }
}

.card-grid-3 {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: 1fr;

  @media (min-width: $breakpoint-medium) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: $breakpoint-large) {
    grid-template-columns: repeat(3, 1fr);
  }
}

.card-grid-4 {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: 1fr;

  @media (min-width: $breakpoint-compact) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: $breakpoint-expanded) {
    grid-template-columns: repeat(3, 1fr);
  }

  @media (min-width: $breakpoint-large) {
    grid-template-columns: repeat(4, 1fr);
  }
}

// ============================================================================
// 18. MASONRY LAYOUTS
// ============================================================================

.masonry {
  column-count: 1;
  column-gap: var(--md-layout-grid-gap);

  @media (min-width: $breakpoint-medium) {
    column-count: 2;
  }

  @media (min-width: $breakpoint-large) {
    column-count: 3;
  }

  > * {
    break-inside: avoid;
    margin-bottom: var(--md-layout-grid-gap);
  }
}

.masonry-4 {
  @extend .masonry;

  @media (min-width: $breakpoint-xlarge) {
    column-count: 4;
  }
}

// ============================================================================
// 19. FULL-BLEED LAYOUTS
// ============================================================================

.full-bleed {
  width: 100vw;
  margin-inline-start: 50%;
  transform: translateX(-50%);
}

.full-bleed-container {
  @extend .full-bleed;
  padding-inline: var(--md-layout-padding-compact);

  @media (min-width: $breakpoint-medium) {
    padding-inline: var(--md-layout-padding-medium);
  }

  @media (min-width: $breakpoint-expanded) {
    padding-inline: var(--md-layout-padding-expanded);
  }
}

// ============================================================================
// 20. RESPONSIVE MEDIA QUERIES
// ============================================================================

// Hide at breakpoints
.hide-compact {
  @media (max-width: #{$breakpoint-medium - 1px}) {
    display: none !important;
  }
}

.hide-medium {
  @media (min-width: $breakpoint-medium) and (max-width: #{$breakpoint-expanded - 1px}) {
    display: none !important;
  }
}

.hide-expanded {
  @media (min-width: $breakpoint-expanded) and (max-width: #{$breakpoint-large - 1px}) {
    display: none !important;
  }
}

.hide-large {
  @media (min-width: $breakpoint-large) and (max-width: #{$breakpoint-xlarge - 1px}) {
    display: none !important;
  }
}

.hide-xlarge {
  @media (min-width: $breakpoint-xlarge) {
    display: none !important;
  }
}

// Show only at breakpoints
.show-compact-only {
  @media (min-width: $breakpoint-medium) {
    display: none !important;
  }
}

.show-medium-up {
  @media (max-width: #{$breakpoint-medium - 1px}) {
    display: none !important;
  }
}

.show-expanded-up {
  @media (max-width: #{$breakpoint-expanded - 1px}) {
    display: none !important;
  }
}

.show-large-up {
  @media (max-width: #{$breakpoint-large - 1px}) {
    display: none !important;
  }
}

.show-xlarge-up {
  @media (max-width: #{$breakpoint-xlarge - 1px}) {
    display: none !important;
  }
}

// ============================================================================
// 21. RTL SUPPORT
// ============================================================================

[dir="rtl"] {
  .with-sidebar,
  .with-sidebar-right {
    flex-direction: row-reverse;
  }

  .layout-sidebar {
    @media (min-width: $breakpoint-expanded) {
      grid-template-columns: 1fr var(--md-layout-sidebar-medium);
    }

    @media (min-width: $breakpoint-large) {
      grid-template-columns: 1fr var(--md-layout-sidebar-wide);
    }
  }

  .layout-sidebar-right {
    @media (min-width: $breakpoint-expanded) {
      grid-template-columns: var(--md-layout-sidebar-medium) 1fr;
    }

    @media (min-width: $breakpoint-large) {
      grid-template-columns: var(--md-layout-sidebar-wide) 1fr;
    }
  }
}

// ============================================================================
// 22. ACCESSIBILITY
// ============================================================================

// Skip to content link
.skip-to-content {
  position: absolute;
  top: -100%;
  left: 50%;
  transform: translateX(-50%);
  padding: 16px 24px;
  background: var(--md-sys-color-primary);
  color: var(--md-sys-color-on-primary);
  border-radius: var(--md-sys-shape-corner-medium, 12px);
  font-weight: 500;
  z-index: var(--md-layout-z-max);
  text-decoration: none;

  &:focus {
    top: 16px;
    outline: 3px solid var(--md-sys-color-outline);
    outline-offset: 2px;
  }
}

// Focus visible for layout elements
.focusable-layout {
  &:focus-visible {
    outline: 3px solid var(--md-sys-color-primary);
    outline-offset: 2px;
  }
}

// Reduced motion preferences
@media (prefers-reduced-motion: reduce) {
  .aurora-gradient-bg::before {
    animation: none;
  }

  * {
    scroll-behavior: auto !important;
  }
}

// ============================================================================
// 23. LAYOUT MIXINS
// ============================================================================

// Container mixin
@mixin container($max-width: var(--md-layout-container-max)) {
  width: 100%;
  max-width: $max-width;
  margin-inline: auto;
  padding-inline: var(--md-layout-padding-compact);

  @media (min-width: $breakpoint-medium) {
    padding-inline: var(--md-layout-padding-medium);
  }

  @media (min-width: $breakpoint-expanded) {
    padding-inline: var(--md-layout-padding-expanded);
  }

  @media (min-width: $breakpoint-large) {
    padding-inline: var(--md-layout-padding-large);
  }
}

// Section mixin
@mixin section-spacing {
  padding-block: var(--md-layout-section-spacing-compact);

  @media (min-width: $breakpoint-medium) {
    padding-block: var(--md-layout-section-spacing-medium);
  }

  @media (min-width: $breakpoint-expanded) {
    padding-block: var(--md-layout-section-spacing-expanded);
  }

  @media (min-width: $breakpoint-large) {
    padding-block: var(--md-layout-section-spacing-large);
  }
}

// Grid mixin
@mixin grid($columns: 12, $gap: var(--md-layout-grid-gap)) {
  display: grid;
  grid-template-columns: repeat($columns, 1fr);
  gap: $gap;
}

// Auto grid mixin
@mixin auto-grid($min-size: 280px, $gap: var(--md-layout-grid-gap)) {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax($min-size, 1fr));
  gap: $gap;
}

// Responsive columns mixin
@mixin responsive-columns($compact: 1, $medium: 2, $expanded: 3, $large: 4) {
  display: grid;
  gap: var(--md-layout-grid-gap);
  grid-template-columns: repeat($compact, 1fr);

  @media (min-width: $breakpoint-medium) {
    grid-template-columns: repeat($medium, 1fr);
  }

  @media (min-width: $breakpoint-expanded) {
    grid-template-columns: repeat($expanded, 1fr);
  }

  @media (min-width: $breakpoint-large) {
    grid-template-columns: repeat($large, 1fr);
  }
}

// Stack mixin
@mixin stack($gap: 16px) {
  display: flex;
  flex-direction: column;
  gap: $gap;
}

// Cluster mixin
@mixin cluster($gap: 16px) {
  display: flex;
  flex-wrap: wrap;
  gap: $gap;
  align-items: center;
}

// Sidebar layout mixin
@mixin with-sidebar($sidebar-width: var(--md-layout-sidebar-medium), $gap: var(--md-layout-grid-gap), $min-content: 50%) {
  display: flex;
  flex-wrap: wrap;
  gap: $gap;

  > :first-child {
    flex-basis: $sidebar-width;
    flex-grow: 1;
  }

  > :last-child {
    flex-basis: 0;
    flex-grow: 999;
    min-width: $min-content;
  }
}

// Center content mixin
@mixin center-content($max-width: var(--md-layout-content-medium)) {
  max-width: $max-width;
  margin-inline: auto;
  padding-inline: var(--md-layout-padding-compact);

  @media (min-width: $breakpoint-medium) {
    padding-inline: var(--md-layout-padding-medium);
  }
}

// Full bleed mixin
@mixin full-bleed {
  width: 100vw;
  margin-inline-start: 50%;
  transform: translateX(-50%);
}

// Holy grail layout mixin
@mixin holy-grail {
  display: grid;
  min-height: 100vh;
  grid-template-rows: auto 1fr auto;
  grid-template-columns: 1fr;
}

// Breakpoint mixin
@mixin breakpoint($size) {
  @if map-has-key($breakpoints, $size) {
    @media (min-width: map-get($breakpoints, $size)) {
      @content;
    }
  } @else {
    @media (min-width: $size) {
      @content;
    }
  }
}

// Breakpoint down mixin
@mixin breakpoint-down($size) {
  @if map-has-key($breakpoints, $size) {
    @media (max-width: #{map-get($breakpoints, $size) - 1px}) {
      @content;
    }
  } @else {
    @media (max-width: #{$size - 1px}) {
      @content;
    }
  }
}

// Breakpoint between mixin
@mixin breakpoint-between($min, $max) {
  $min-val: if(map-has-key($breakpoints, $min), map-get($breakpoints, $min), $min);
  $max-val: if(map-has-key($breakpoints, $max), map-get($breakpoints, $max), $max);

  @media (min-width: $min-val) and (max-width: #{$max-val - 1px}) {
    @content;
  }
}
